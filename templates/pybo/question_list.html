{% extends 'base.html' %}
{% block content %}
<div class="flex justify-between items-center mb-8 flex-wrap gap-4">
    <a href="{% url 'pybo:question_create' %}" class="rounded-full px-6 py-2 bg-primary text-white font-semibold hover:bg-blue-600 transition shadow">
        질문 등록하기
    </a>
    <div class="flex gap-2">
        <button type="button" onclick="setSort('recent')" class="rounded-full px-4 py-2 font-medium border border-primary text-primary hover:bg-primary hover:text-white transition {% if sort == 'recent' or not sort %}bg-primary text-white{% endif %}">
            최신순
        </button>
        <button type="button" onclick="setSort('popular')" class="rounded-full px-4 py-2 font-medium border border-primary text-primary hover:bg-primary hover:text-white transition {% if sort == 'popular' %}bg-primary text-white{% endif %}">
            인기순
        </button>
    </div>
</div>
{% if question_list %}
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
    {% for question in question_list %}
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow hover:shadow-xl transition p-6 flex flex-col justify-between">
        <a href="{% url 'pybo:detail' question.id %}" class="block font-bold text-xl md:text-2xl text-gray-900 dark:text-white mb-3 hover:underline">
            {{ question.subject }}
        </a>
        <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400 mt-auto">
            <span class="flex items-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4m0-4h.01"/></svg>
                {{ question.author.username }}
            </span>
            <span>
                {{ question.create_date|date:"Y년 m월 d일" }}
            </span>
            <span class="flex items-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M17 8h2a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2v-8a2 2 0 012-2h2"/><path d="M15 3h-6a2 2 0 00-2 2v2a2 2 0 002 2h6a2 2 0 002-2V5a2 2 0 00-2-2z"/></svg>
                {{ question.num_answers|default:question.answer_set.count }} 답변
            </span>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="text-center text-gray-500 dark:text-gray-400 py-16">질문이 없습니다.</div>
{% endif %}
<form id="sortForm" method="get" action="{% url 'pybo:index' %}">
    <input type="hidden" name="sort" id="sortInput" value="{{ sort|default_if_none:'recent' }}">
    <input type="hidden" name="kw" value="{{ kw|default_if_none:'' }}">
    <input type="hidden" name="page" value="{{ page }}">
</form>
<div class="flex justify-center mt-10">
    <ul class="inline-flex -space-x-px">
        {% if question_list.has_previous %}
        <li>
            <a href="javascript:void(0)" onclick="goPage({{ question_list.previous_page_number }})" class="px-3 py-2 rounded-l-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 hover:bg-primary hover:text-white transition">이전</a>
        </li>
        {% endif %}
        {% for page_number in question_list.paginator.page_range %}
        {% if page_number >= question_list.number|add:-5 and page_number <= question_list.number|add:5 %}
        <li>
            <a href="javascript:void(0)" onclick="goPage({{ page_number }})"
               class="px-3 py-2 border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 hover:bg-primary hover:text-white transition {% if page_number == question_list.number %}bg-primary text-white{% endif %}">
                {{ page_number }}
            </a>
        </li>
        {% endif %}
        {% endfor %}
        {% if question_list.has_next %}
        <li>
            <a href="javascript:void(0)" onclick="goPage({{ question_list.next_page_number }})" class="px-3 py-2 rounded-r-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 hover:bg-primary hover:text-white transition">다음</a>
        </li>
        {% endif %}
    </ul>
</div>
<script>
function setSort(sort) {
    document.getElementById('sortInput').value = sort;
    document.getElementById('sortForm').submit();
}
function goPage(page) {
    document.querySelector('input[name="page"]').value = page;
    document.getElementById('sortForm').submit();
}
</script>
{% endblock %}